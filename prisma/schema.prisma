generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-3.0.x", "windows"]
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model User {
  id                     String                  @id @default(uuid())
  email                  String                  @unique
  passwordHash           String                  @map("password_hash")
  firstName              String?                 @map("first_name") @db.VarChar(100)
  lastName               String?                 @map("last_name") @db.VarChar(100)
  phone                  String?                 @db.VarChar(20)
  role                   UserRole                @default(USER)
  avatarUrl              String?                 @map("avatar_url")
  emailVerified          Boolean                 @default(false) @map("email_verified")
  verificationToken      String?                 @unique @map("verification_token")
  resetToken             String?                 @unique @map("reset_token")
  resetTokenExpiry       DateTime?               @map("reset_token_expiry")
  createdAt              DateTime                @default(now()) @map("created_at")
  updatedAt              DateTime                @updatedAt @map("updated_at")
  isActive               Boolean                 @default(true) @map("is_active")
  lastLoginAt            DateTime?               @map("last_login_at")
  loginCount             Int                     @default(0) @map("login_count")
  applications           Application[]
  bookings               Booking[]
  consultationBookings   ConsultationBooking[]
  assignedChats          ChatConversation[]      @relation("AdminChats")
  chatConversations      ChatConversation[]
  createdEvents          Event[]
  uploadedGalleryImages  GalleryImage[]
  notifications          notifications[]
  createdPrograms        Program[]
  // reservations           Reservation[]  // DEPRECATED - removed
  createdServices        Service[]
  testimonials           Testimonial[]
  createdTravelers       Traveler[]
  userAcademicProfile    UserAcademicProfile?
  activities             UserActivity[]
  profile                UserProfile?
  wishlists              UserWishlist[]
  deviceTokens           device_tokens[]
  flightReservations     FlightReservation[]
  hotelReservations      HotelReservation[]
  packageReservations    PackageReservation[]
  visaAssistanceBookings VisaAssistanceBooking[]
  itineraryBookings      ItineraryBooking[]

  @@map("users")
}

model UserProfile {
  id               String    @id @default(uuid())
  userId           String    @unique @map("user_id")
  dateOfBirth      DateTime? @map("date_of_birth") @db.Date
  nationality      String?   @db.VarChar(100)
  passportNumber   String?   @map("passport_number") @db.VarChar(50)
  emergencyContact String?   @map("emergency_contact") @db.VarChar(100)
  emergencyPhone   String?   @map("emergency_phone") @db.VarChar(20)
  address          String?   @db.VarChar(500)
  city             String?   @db.VarChar(100)
  state            String?   @db.VarChar(100)
  postalCode       String?   @map("postal_code") @db.VarChar(20)
  country          String?   @db.VarChar(100)
  preferences      Json?
  createdAt        DateTime  @default(now()) @map("created_at")
  updatedAt        DateTime  @updatedAt @map("updated_at")
  work_experience  Json?
  user             User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("user_profiles")
}

model Service {
  id              String         @id @default(uuid())
  title           String         @db.VarChar(300)
  slug            String         @unique @db.VarChar(300)
  tagline         String?        @db.VarChar(200)
  description     String?
  fullDescription String?        @map("full_description")
  iconName        String?        @map("icon_name") @db.VarChar(100)
  category        String?        @db.VarChar(100)
  color           String?        @db.VarChar(50)
  imageUrl        String?        @map("image_url")
  features        Json?
  priceRange      String?        @map("price_range") @db.VarChar(100)
  isActive        Boolean        @default(true) @map("is_active")
  displayOrder    Int            @default(0) @map("display_order")
  createdById     String?        @map("created_by")
  createdAt            DateTime                @default(now()) @map("created_at")
  updatedAt            DateTime                @updatedAt @map("updated_at")
  bookings               Booking[]
  consultationBookings   ConsultationBooking[]
  programs               Program[]
  createdBy              User?                   @relation(fields: [createdById], references: [id])
  wishlists              UserWishlist[]
  visaAssistanceBookings VisaAssistanceBooking[]
  itineraryBookings      ItineraryBooking[]

  @@map("services")
}

model Program {
  id                   String                 @id @default(uuid())
  serviceId            String                 @map("service_id")
  title                String                 @db.VarChar(300)
  slug                 String                 @unique @db.VarChar(300)
  tagline              String?                @db.VarChar(200)
  description          String?
  fullDescription      String?                @map("full_description")
  country              String?                @db.VarChar(100)
  university           String?                @db.VarChar(300)
  duration             String?                @db.VarChar(100)
  startDate            DateTime?              @map("start_date") @db.Date
  endDate              DateTime?              @map("end_date") @db.Date
  deadline             DateTime?              @db.Date
  imageUrl             String?                @map("image_url")
  features             Json?
  requirements         Json?
  benefits             Json?
  tuitionFee           String?                @map("tuition_fee") @db.VarChar(100)
  applicationFee       String?                @map("application_fee") @db.VarChar(100)
  scholarshipType      String?                @map("scholarship_type") @db.VarChar(100)
  isActive             Boolean                @default(true) @map("is_active")
  displayOrder         Int                    @default(0) @map("display_order")
  availableSlots       Int?                   @map("available_slots")
  createdById          String?                @map("created_by")
  createdAt            DateTime               @default(now()) @map("created_at")
  updatedAt            DateTime               @updatedAt @map("updated_at")
  applications         Application[]
  programEligibility   ProgramEligibility[]
  programRequirements  ProgramRequirement[]   @relation("ProgramRequirements")
  createdBy            User?                  @relation(fields: [createdById], references: [id])
  service              Service                @relation(fields: [serviceId], references: [id], onDelete: Cascade)

  @@map("programs")
}

model Event {
  id                  String         @id @default(uuid())
  title               String         @db.VarChar(200)
  slug                String         @unique @db.VarChar(200)
  description         String?
  imageUrl            String?        @map("image_url")
  location            String?        @db.VarChar(200)
  startDate           DateTime?      @map("start_date") @db.Date
  endDate             DateTime?      @map("end_date") @db.Date
  duration            String?        @db.VarChar(50)
  status              EventStatus    @default(UPCOMING)
  category            String?        @db.VarChar(50)
  price               Decimal?       @db.Decimal(10, 2)
  maxParticipants     Int?           @map("max_participants")
  currentParticipants Int            @default(0) @map("current_participants")
  includes            Json?
  requirements        Json?
  itinerary           Json?
  isFeatured          Boolean        @default(false) @map("is_featured")
  isActive            Boolean        @default(true) @map("is_active")
  createdById         String?        @map("created_by")
  createdAt           DateTime       @default(now()) @map("created_at")
  updatedAt           DateTime       @updatedAt @map("updated_at")
  endTime             String?        @map("end_time") @db.VarChar(20)
  locationLat         Float?         @map("location_lat")
  locationLng         Float?         @map("location_lng")
  startTime           String?        @map("start_time") @db.VarChar(20)
  bookings            Booking[]
  images              EventImage[]
  createdBy           User?          @relation(fields: [createdById], references: [id])
  wishlists           UserWishlist[]

  @@map("events")
}

model EventImage {
  id           String   @id @default(uuid())
  eventId      String   @map("event_id")
  imageUrl     String   @map("image_url")
  caption      String?
  displayOrder Int      @default(0) @map("display_order")
  createdAt    DateTime @default(now()) @map("created_at")
  event        Event    @relation(fields: [eventId], references: [id], onDelete: Cascade)

  @@map("event_images")
}

model Booking {
  id              String        @id @default(uuid())
  userId          String        @map("user_id")
  eventId         String?       @map("event_id")
  serviceId       String?       @map("service_id")
  bookingType     String        @map("booking_type") @db.VarChar(20)
  status          BookingStatus @default(PENDING)
  participants    Int           @default(1)
  totalAmount     Decimal?      @map("total_amount") @db.Decimal(10, 2)
  paymentStatus   PaymentStatus @default(PENDING) @map("payment_status")
  specialRequests String?       @map("special_requests")
  bookingDate     DateTime      @default(now()) @map("booking_date")
  confirmedAt     DateTime?     @map("confirmed_at")
  cancelledAt     DateTime?     @map("cancelled_at")
  createdAt       DateTime      @default(now()) @map("created_at")
  updatedAt       DateTime      @updatedAt @map("updated_at")
  event           Event?        @relation(fields: [eventId], references: [id])
  service         Service?      @relation(fields: [serviceId], references: [id])
  user            User          @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("bookings")
}

model ConsultationBooking {
  id                   String        @id @default(uuid())
  userId               String        @map("user_id")
  serviceId            String        @map("service_id")
  
  // Section 1: Contact Information
  contactFullName      String        @map("contact_full_name") @db.VarChar(200)
  contactEmail         String        @map("contact_email") @db.VarChar(200)
  contactPhone         String        @map("contact_phone") @db.VarChar(50)
  contactResidence     String        @map("contact_residence") @db.VarChar(300)
  
  // Section 1.2: Travel Party (stored as JSON array)
  travelers            Json          // Array of traveler objects
  travelerCount        Int           @map("traveler_count")
  feeEstimate          Decimal       @map("fee_estimate") @db.Decimal(10, 2)
  
  // Section 2: Trip Specifics
  destinationClarity   String        @map("destination_clarity") @db.VarChar(50)
  destinationDetails   String?       @map("destination_details")
  travelStartDate      DateTime      @map("travel_start_date") @db.Date
  travelEndDate        DateTime      @map("travel_end_date") @db.Date
  tripDuration         String        @map("trip_duration") @db.VarChar(50)
  tripType             Json          @map("trip_type") // Array of selected types
  mustDoActivities     String        @map("must_do_activities")
  accommodationStyle   String        @map("accommodation_style") @db.VarChar(100)
  
  // Section 3: Ghana-Specific Logistics
  transportMethod      Json          @map("transport_method") // Array
  carSeatNeeds         Json?         @map("car_seat_needs") // Array
  driverRequirement    String?       @map("driver_requirement") @db.VarChar(100)
  yellowFever          String        @map("yellow_fever") @db.VarChar(50)
  malariaPlan          String        @map("malaria_plan") @db.VarChar(100)
  dietaryRestrictions  Json?         @map("dietary_restrictions") // Array
  totalBudget          String        @map("total_budget") @db.VarChar(50)
  spendingStyle        String        @map("spending_style") @db.VarChar(50)
  
  // Section 4: Submission Details
  referralSource       String        @map("referral_source") @db.VarChar(100)
  
  // Payment & Status
  status               BookingStatus @default(PENDING)
  paymentStatus        PaymentStatus @default(PENDING) @map("payment_status")
  paymentReference     String?       @map("payment_reference") @db.VarChar(100)
  
  // Metadata
  createdAt            DateTime      @default(now()) @map("created_at")
  updatedAt            DateTime      @updatedAt @map("updated_at")
  confirmedAt          DateTime?     @map("confirmed_at")
  
  // Relations
  user                 User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  service              Service       @relation(fields: [serviceId], references: [id])
  
  @@map("consultation_bookings")
}

model UserActivity {
  id           String   @id @default(uuid())
  userId       String   @map("user_id")
  activityType String   @map("activity_type") @db.VarChar(50)
  activityData Json?    @map("activity_data")
  ipAddress    String?  @map("ip_address") @db.VarChar(50)
  userAgent    String?  @map("user_agent")
  createdAt    DateTime @default(now()) @map("created_at")
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("user_activities")
}

model UserWishlist {
  id        String   @id @default(uuid())
  userId    String   @map("user_id")
  eventId   String?  @map("event_id")
  serviceId String?  @map("service_id")
  itemType  String   @map("item_type") @db.VarChar(20)
  createdAt DateTime @default(now()) @map("created_at")
  event     Event?   @relation(fields: [eventId], references: [id])
  service   Service? @relation(fields: [serviceId], references: [id])
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("user_wishlists")
}

model Testimonial {
  id         String   @id @default(uuid())
  userId     String?  @map("user_id")
  name       String   @db.VarChar(100)
  title      String?  @db.VarChar(100)
  content    String
  avatarUrl  String?  @map("avatar_url")
  rating     Int?     @db.SmallInt
  isFeatured Boolean  @default(false) @map("is_featured")
  isApproved Boolean  @default(false) @map("is_approved")
  createdAt  DateTime @default(now()) @map("created_at")
  updatedAt  DateTime @updatedAt @map("updated_at")
  user       User?    @relation(fields: [userId], references: [id])

  @@map("testimonials")
}

model GalleryImage {
  id           String   @id @default(uuid())
  title        String?  @db.VarChar(200)
  description  String?
  imageUrl     String   @map("image_url")
  category     String?  @db.VarChar(50)
  tags         Json?
  isFeatured   Boolean  @default(false) @map("is_featured")
  displayOrder Int      @default(0) @map("display_order")
  uploadedById String?  @map("uploaded_by")
  createdAt    DateTime @default(now()) @map("created_at")
  uploadedBy   User?    @relation(fields: [uploadedById], references: [id])

  @@map("gallery_images")
}

model Traveler {
  id             String        @id @default(uuid())
  firstName      String        @map("first_name") @db.VarChar(100)
  middleName     String?       @map("middle_name") @db.VarChar(100)
  surname        String        @db.VarChar(100)
  sex            Sex
  nationality    String        @db.VarChar(100)
  dateOfBirth    DateTime      @map("date_of_birth") @db.Date
  placeOfBirth   String        @map("place_of_birth") @db.VarChar(200)
  passportNumber String        @map("passport_number") @db.VarChar(50)
  workTitle      String?       @map("work_title") @db.VarChar(200)
  email          String?       @db.VarChar(255)
  phone          String?       @db.VarChar(20)
  address        String?
  paymentAmount  Decimal?      @map("payment_amount") @db.Decimal(10, 2)
  paymentDate    DateTime?     @map("payment_date")
  paymentStatus  PaymentStatus @default(PENDING) @map("payment_status")
  processStatus  ProcessStatus @default(INQUIRY) @map("process_status")
  notes          String?
  createdById    String        @map("created_by")
  createdAt      DateTime      @default(now()) @map("created_at")
  updatedAt      DateTime      @updatedAt @map("updated_at")
  deletedAt      DateTime?     @map("deleted_at")
  createdBy      User          @relation(fields: [createdById], references: [id])

  @@map("travelers")
}

model Application {
  id                       String            @id @default(uuid())
  programName              String            @map("program_name") @db.VarChar(300)
  programCountry           String            @map("program_country") @db.VarChar(100)
  programUniversity        String?           @map("program_university") @db.VarChar(300)
  programStartDate         DateTime?         @map("program_start_date") @db.Date
  programEndDate           DateTime?         @map("program_end_date") @db.Date
  programDuration          String?           @map("program_duration") @db.VarChar(100)
  firstName                String?           @map("first_name") @db.VarChar(100)
  middleName               String?           @map("middle_name") @db.VarChar(100)
  lastName                 String?           @map("last_name") @db.VarChar(100)
  dateOfBirth              DateTime?         @map("date_of_birth") @db.Date
  placeOfBirth             String?           @map("place_of_birth") @db.VarChar(200)
  nationality              String?           @db.VarChar(100)
  sex                      Sex?
  email                    String?           @db.VarChar(200)
  phone                    String?           @db.VarChar(20)
  alternativePhone         String?           @map("alternative_phone") @db.VarChar(20)
  address                  String?
  city                     String?           @db.VarChar(100)
  state                    String?           @db.VarChar(100)
  postalCode               String?           @map("postal_code") @db.VarChar(20)
  country                  String?           @db.VarChar(100)
  motherName               String?           @map("mother_name") @db.VarChar(200)
  motherOccupation         String?           @map("mother_occupation") @db.VarChar(200)
  motherPhone              String?           @map("mother_phone") @db.VarChar(20)
  fatherName               String?           @map("father_name") @db.VarChar(200)
  fatherOccupation         String?           @map("father_occupation") @db.VarChar(200)
  fatherPhone              String?           @map("father_phone") @db.VarChar(20)
  emergencyContactName     String?           @map("emergency_contact_name") @db.VarChar(200)
  emergencyContactPhone    String?           @map("emergency_contact_phone") @db.VarChar(20)
  emergencyContactRelation String?           @map("emergency_contact_relation") @db.VarChar(100)
  currentEducationLevel    String?           @map("current_education_level") @db.VarChar(100)
  schoolName               String?           @map("school_name") @db.VarChar(300)
  gradeLevel               String?           @map("grade_level") @db.VarChar(50)
  gpa                      String?           @db.VarChar(20)
  passportNumber           String?           @map("passport_number") @db.VarChar(50)
  passportIssueDate        DateTime?         @map("passport_issue_date") @db.Date
  passportExpiryDate       DateTime?         @map("passport_expiry_date") @db.Date
  passportIssueCountry     String?           @map("passport_issue_country") @db.VarChar(100)
  previousTravel           Boolean           @default(false) @map("previous_travel")
  previousTravelDetails    String?           @map("previous_travel_details")
  medicalConditions        String?           @map("medical_conditions")
  specialRequirements      String?           @map("special_requirements")
  motivation               String?
  passportCopyUrl          String?           @map("passport_copy_url")
  photoUrl                 String?           @map("photo_url")
  birthCertificateUrl      String?           @map("birth_certificate_url")
  transcriptUrl            String?           @map("transcript_url")
  additionalDocuments      Json?             @map("additional_documents")
  status                   ApplicationStatus @default(DRAFT)
  submittedAt              DateTime?         @map("submitted_at")
  reviewedAt               DateTime?         @map("reviewed_at")
  reviewedBy               String?           @map("reviewed_by")
  reviewNotes              String?           @map("review_notes")
  applicationFee           Decimal?          @map("application_fee") @db.Decimal(10, 2)
  paymentStatus            PaymentStatus     @default(PENDING) @map("payment_status")
  paymentReference         String?           @map("payment_reference") @db.VarChar(100)
  userId                   String            @map("user_id")
  createdAt                DateTime          @default(now()) @map("created_at")
  updatedAt                DateTime          @updatedAt @map("updated_at")
  programId                String?           @map("program_id")
  medicalResultsUrl        String?           @map("medical_results_url")
  wassceUrl                String?           @map("wassce_url")
  education                Json?
  homeNumber               String?           @map("home_number") @db.VarChar(50)
  postalAddress            String?           @map("postal_address") @db.VarChar(100)
  streetAddress            String?           @map("street_address")
  workExperience           Json?             @map("work_experience")
  program                  Program?          @relation(fields: [programId], references: [id])
  user                     User              @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("applications")
}

// DEPRECATED: Old Reservation model - replaced by FlightReservation, HotelReservation, PackageReservation
// Commented out to prevent Prisma client errors since table doesn't exist in database
// model Reservation {
//   id              String            @id @default(uuid())
//   userId          String            @map("user_id")
//   reservationType ReservationType   @map("reservation_type")
//   status          ReservationStatus @default(PENDING_QUOTE)
//   fullName        String            @map("full_name") @db.VarChar(200)
//   email           String            @db.VarChar(200)
//   phone           String            @db.VarChar(20)
//   flightType      String?           @map("flight_type") @db.VarChar(20)
//   departureCity   String?           @map("departure_city") @db.VarChar(200)
//   arrivalCity     String?           @map("arrival_city") @db.VarChar(200)
//   departureDate   DateTime?         @map("departure_date") @db.Date
//   returnDate      DateTime?         @map("return_date") @db.Date
//   passengers      Int?              @default(1)
//   travelClass     String?           @map("travel_class") @db.VarChar(50)
//   hotelCity       String?           @map("hotel_city") @db.VarChar(200)
//   checkInDate     DateTime?         @map("check_in_date") @db.Date
//   checkOutDate    DateTime?         @map("check_out_date") @db.Date
//   rooms           Int?              @default(1)
//   guests          Int?              @default(1)
//   hotelPreference String?           @map("hotel_preference") @db.VarChar(50)
//   specialRequests String?           @map("special_requests")
//   confirmedAt     DateTime?         @map("confirmed_at")
//   cancelledAt     DateTime?         @map("cancelled_at")
//   createdAt       DateTime          @default(now()) @map("created_at")
//   updatedAt       DateTime          @updatedAt @map("updated_at")
//   user            User              @relation(fields: [userId], references: [id], onDelete: Cascade)
//
//   @@map("reservations")
// }

model ChatConversation {
  id              String        @id @default(uuid())
  userId          String?       @map("user_id")
  visitorName     String?       @map("visitor_name") @db.VarChar(200)
  visitorEmail    String?       @map("visitor_email") @db.VarChar(200)
  status          ChatStatus    @default(ACTIVE)
  assignedAdminId String?       @map("assigned_admin_id")
  lastMessageAt   DateTime?     @map("last_message_at")
  isAdminOnline   Boolean       @default(false) @map("is_admin_online")
  adminLastSeenAt DateTime?     @map("admin_last_seen_at")
  resolvedAt      DateTime?     @map("resolved_at")
  createdAt       DateTime      @default(now()) @map("created_at")
  updatedAt       DateTime      @updatedAt @map("updated_at")
  assignedAdmin   User?         @relation("AdminChats", fields: [assignedAdminId], references: [id])
  user            User?         @relation(fields: [userId], references: [id])
  messages        ChatMessage[]

  @@map("chat_conversations")
}

model ChatMessage {
  id             String            @id @default(uuid())
  conversationId String            @map("conversation_id")
  sender         ChatMessageSender
  senderId       String?           @map("sender_id")
  message        String
  isRead         Boolean           @default(false) @map("is_read")
  readAt         DateTime?         @map("read_at")
  metadata       Json?
  createdAt      DateTime          @default(now()) @map("created_at")
  conversation   ChatConversation  @relation(fields: [conversationId], references: [id], onDelete: Cascade)

  @@index([conversationId])
  @@index([createdAt])
  @@map("chat_messages")
}

model AdminChatStatus {
  id           String   @id @default(uuid())
  adminId      String   @unique @map("admin_id")
  isOnline     Boolean  @default(false) @map("is_online")
  lastActiveAt DateTime @default(now()) @map("last_active_at")
  autoRespond  Boolean  @default(true) @map("auto_respond")
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")

  @@map("admin_chat_status")
}

model device_tokens {
  id          String   @id @default(uuid())
  user_id     String
  token       String   @unique
  device_type String?  @db.VarChar(50)
  user_agent  String?
  is_active   Boolean  @default(true)
  created_at  DateTime @default(now())
  updated_at  DateTime

  user        User     @relation(fields: [user_id], references: [id], onDelete: Cascade)
  @@index([user_id])
}

model DocumentTemplate {
  id                 String          @id @default(uuid())
  name               String          @db.VarChar(200)
  description        String?
  educationLevel     EducationLevel  @map("education_level")
  requiredDocuments  Json            @map("required_documents")
  optionalDocuments  Json?           @map("optional_documents")
  isActive           Boolean         @default(true) @map("is_active")
  createdAt          DateTime        @default(now()) @map("created_at")
  updatedAt          DateTime        @updatedAt @map("updated_at")

  @@map("document_templates")
}

model notifications {
  id         String           @id @default(uuid())
  user_id    String
  type       NotificationType
  title      String           @db.VarChar(255)
  message    String
  action_url String?
  is_read    Boolean          @default(false)
  read_at    DateTime?
  metadata   Json?
  created_at DateTime         @default(now())
  users      User             @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([user_id, created_at])
  @@index([user_id, is_read])
}

model ProgramEligibility {
  id                   String               @id @default(uuid())
  userId               String               @map("user_id")
  programId            String               @map("program_id")
  eligibilityScore     Int                  @default(0) @map("eligibility_score")
  isEligible           Boolean              @default(false) @map("is_eligible")
  missingRequirements  Json?                @map("missing_requirements")
  metRequirements      Json?                @map("met_requirements")
  recommendationNotes  String?              @map("recommendation_notes")
  lastCalculatedAt     DateTime             @default(now()) @map("last_calculated_at")
  createdAt            DateTime             @default(now()) @map("created_at")
  updatedAt            DateTime             @updatedAt @map("updated_at")
  program              Program              @relation(fields: [programId], references: [id], onDelete: Cascade)
  userAcademicProfile  UserAcademicProfile  @relation(fields: [userId], references: [userId], onDelete: Cascade)

  @@unique([userId, programId])
  @@index([programId])
  @@index([userId])
  @@index([userId, isEligible])
  @@index([userId, isEligible], map: "idx_program_eligibility_eligible")
  @@index([programId], map: "idx_program_eligibility_program_id")
  @@index([userId], map: "idx_program_eligibility_user_id")
  @@map("program_eligibility")
}

model ProgramRequirement {
  id                           String         @id @default(uuid())
  programId                    String         @map("program_id")
  minimumGpa                   Decimal?       @map("minimum_gpa") @db.Decimal(3, 2)
  gradingSystem                GradingSystem? @map("grading_system")
  requiredDocuments            Json           @map("required_documents")
  toeflMinimum                 Int?           @map("toefl_minimum")
  ieltsMinimum                 Decimal?       @map("ielts_minimum") @db.Decimal(2, 1)
  duolingoMinimum              Int?           @map("duolingo_minimum")
  pteMinimum                   Int?           @map("pte_minimum")
  satMinimum                   Int?           @map("sat_minimum")
  actMinimum                   Int?           @map("act_minimum")
  greMinimum                   Int?           @map("gre_minimum")
  gmatMinimum                  Int?           @map("gmat_minimum")
  workExperienceRequired       Boolean        @default(false) @map("work_experience_required")
  minimumWorkExperienceYears   Int?           @map("minimum_work_experience_years")
  ageRequirement               Json?          @map("age_requirement")
  requiredPrerequisites        Json?          @map("required_prerequisites")
  additionalRequirements       String?        @map("additional_requirements")
  createdAt                    DateTime       @default(now()) @map("created_at")
  updatedAt                    DateTime       @updatedAt @map("updated_at")
  acceptedCourses              Json?          @map("accepted_courses")
  acceptedFundingTypes         Json?          @map("accepted_funding_types")
  acceptedInstitutions         Json?          @map("accepted_institutions")
  minimumStudyDurationMonths   Int?           @map("minimum_study_duration_months")
  requireCompletionDate        Boolean        @default(false) @map("require_completion_date")
  acceptedEducationLevels      Json           @map("accepted_education_levels")
  
  program                      Program        @relation("ProgramRequirements", fields: [programId], references: [id], onDelete: Cascade)

  @@index([programId])
  @@map("program_requirements")
}

model UserAcademicProfile {
  id                     String                 @id @default(uuid())
  userId                 String                 @unique @map("user_id")
  currentEducationLevel  EducationLevel?        @map("current_education_level")
  highestEducationLevel  EducationLevel?        @map("highest_education_level")
  intendedStudyLevel     EducationLevel?        @map("intended_study_level")
  fieldOfStudy           String?                @db.VarChar(200) @map("field_of_study")
  preferredCountries     Json?                  @map("preferred_countries")
  studyPreferences       Json?                  @map("study_preferences")
  gpa                    String?                @db.VarChar(50)
  gradingSystem          String?                @db.VarChar(50) @map("grading_system")
  institutionName        String?                @db.VarChar(300) @map("institution_name")
  createdAt              DateTime               @default(now()) @map("created_at")
  updatedAt              DateTime               @updatedAt @map("updated_at")
  programEligibility     ProgramEligibility[]
  user                   User                   @relation(fields: [userId], references: [id], onDelete: Cascade)
  userDocuments          UserDocument[]
  userEducationHistory   UserEducationHistory[]
  userTestScores         UserTestScore[]

  @@map("user_academic_profiles")
}

model UserDocument {
  id                   String               @id @default(uuid())
  userId               String               @map("user_id")
  documentType         DocumentType         @map("document_type")
  documentName         String               @db.VarChar(300) @map("document_name")
  fileUrl              String               @map("file_url")
  fileSize             Int?                 @map("file_size")
  mimeType             String?              @db.VarChar(100) @map("mime_type")
  issueDate            DateTime?            @db.Date @map("issue_date")
  expiryDate           DateTime?            @db.Date @map("expiry_date")
  issuingAuthority     String?              @db.VarChar(200) @map("issuing_authority")
  documentNumber       String?              @db.VarChar(100) @map("document_number")
  isVerified           Boolean              @default(false) @map("is_verified")
  verifiedAt           DateTime?            @map("verified_at")
  verifiedBy           String?              @map("verified_by")
  notes                String?
  createdAt            DateTime             @default(now()) @map("created_at")
  updatedAt            DateTime             @updatedAt @map("updated_at")
  completionDate       DateTime?            @db.Date @map("completion_date")
  endDate              DateTime?            @db.Date @map("end_date")
  fundingType          String?              @db.VarChar(50) @map("funding_type")
  institutionName      String?              @db.VarChar(300) @map("institution_name")
  startDate            DateTime?            @db.Date @map("start_date")
  courseOfStudy        String?              @db.VarChar(300) @map("course_of_study")
  userAcademicProfile  UserAcademicProfile  @relation(fields: [userId], references: [userId], onDelete: Cascade)

  @@index([documentType])
  @@index([userId])
  @@index([documentType], map: "idx_user_documents_type")
  @@index([userId], map: "idx_user_documents_user_id")
  @@map("user_documents")
}

model UserEducationHistory {
  id                   String               @id @default(uuid())
  userId               String               @map("user_id")
  institutionName      String               @db.VarChar(300) @map("institution_name")
  institutionCountry   String?              @db.VarChar(100) @map("institution_country")
  educationLevel       EducationLevel       @map("education_level")
  fieldOfStudy         String?              @db.VarChar(200) @map("field_of_study")
  startDate            DateTime?            @db.Date @map("start_date")
  endDate              DateTime?            @db.Date @map("end_date")
  isCurrent            Boolean              @default(false) @map("is_current")
  grade                String?              @db.VarChar(20)
  gradingSystem        GradingSystem?       @map("grading_system")
  graduated            Boolean              @default(false)
  certificateUrl       String?              @map("certificate_url")
  transcriptUrl        String?              @map("transcript_url")
  createdAt            DateTime             @default(now()) @map("created_at")
  updatedAt            DateTime             @updatedAt @map("updated_at")
  userAcademicProfile  UserAcademicProfile  @relation(fields: [userId], references: [userId], onDelete: Cascade)

  @@index([userId])
  @@index([userId], map: "idx_user_education_user_id")
  @@map("user_education_history")
}

model UserTestScore {
  id                   String               @id @default(uuid())
  userId               String               @map("user_id")
  testType             TestType             @map("test_type")
  testDate             DateTime?            @db.Date @map("test_date")
  overallScore         String?              @db.VarChar(20) @map("overall_score")
  readingScore         String?              @db.VarChar(20) @map("reading_score")
  writingScore         String?              @db.VarChar(20) @map("writing_score")
  listeningScore       String?              @db.VarChar(20) @map("listening_score")
  speakingScore        String?              @db.VarChar(20) @map("speaking_score")
  analyticalWriting    String?              @db.VarChar(20) @map("analytical_writing")
  quantitativeScore    String?              @db.VarChar(20) @map("quantitative_score")
  verbalScore          String?              @db.VarChar(20) @map("verbal_score")
  scoreDocumentUrl     String?              @map("score_document_url")
  isVerified           Boolean              @default(false) @map("is_verified")
  expiryDate           DateTime?            @db.Date @map("expiry_date")
  createdAt            DateTime             @default(now()) @map("created_at")
  updatedAt            DateTime             @updatedAt @map("updated_at")
  userAcademicProfile  UserAcademicProfile  @relation(fields: [userId], references: [userId], onDelete: Cascade)

  @@index([userId])
  @@index([userId], map: "idx_user_test_scores_user_id")
  @@map("user_test_scores")
}

enum UserRole {
  USER
  ADMIN
  SUPER_ADMIN
}

enum BookingStatus {
  PENDING
  CONFIRMED
  CANCELLED
  COMPLETED
}

enum PaymentStatus {
  PENDING
  PAID
  REFUNDED
}

enum ReservationStatus {
  PENDING_QUOTE
  QUOTE_SENT
  QUOTE_APPROVED
  CONFIRMED
  CANCELLED
  COMPLETED
}

enum Sex {
  MALE
  FEMALE
  OTHER
}

enum ProcessStatus {
  INQUIRY
  DOCUMENTS_PENDING
  DOCUMENTS_RECEIVED
  DOCUMENTS_VERIFIED
  PAYMENT_PENDING
  PAYMENT_PARTIAL
  PAYMENT_COMPLETE
  VISA_PROCESSING
  VISA_APPROVED
  VISA_REJECTED
  TRAVEL_ARRANGED
  COMPLETED
  CANCELLED
}

enum ApplicationStatus {
  DRAFT
  SUBMITTED
  UNDER_REVIEW
  APPROVED
  REJECTED
  WITHDRAWN
}

enum ReservationType {
  FLIGHT
  HOTEL
  BOTH
}

enum EventStatus {
  UPCOMING
  ONGOING
  ENDED
  CANCELLED
}

enum ChatMessageSender {
  USER
  ADMIN
  AI
}

enum ChatStatus {
  ACTIVE
  RESOLVED
  PENDING_ADMIN
}

enum DocumentType {
  WASSCE_RESULT
  BECE_RESULT
  JHS_TRANSCRIPT
  SHS_TRANSCRIPT
  UNIVERSITY_TRANSCRIPT
  DEGREE_CERTIFICATE
  DIPLOMA_CERTIFICATE
  ACADEMIC_REFERENCE_LETTER
  PASSPORT_COPY
  BIRTH_CERTIFICATE
  NATIONAL_ID
  PASSPORT_PHOTO
  TOEFL_SCORE
  IELTS_SCORE
  DUOLINGO_SCORE
  PTE_SCORE
  SAT_SCORE
  ACT_SCORE
  GRE_SCORE
  GMAT_SCORE
  STATEMENT_OF_PURPOSE
  PERSONAL_STATEMENT
  MOTIVATION_LETTER
  CV_RESUME
  PORTFOLIO
  RESEARCH_PROPOSAL
  BANK_STATEMENT
  SPONSOR_LETTER
  SCHOLARSHIP_LETTER
  FINANCIAL_GUARANTEE
  MEDICAL_CERTIFICATE
  VACCINATION_RECORD
  POLICE_CLEARANCE
  CHARACTER_REFERENCE
  WORK_EXPERIENCE_LETTER
  INTERNSHIP_CERTIFICATE
  EXTRACURRICULAR_CERTIFICATE
  OTHER
}

enum EducationLevel {
  HIGH_SCHOOL
  FOUNDATION
  DIPLOMA
  UNDERGRADUATE
  POSTGRADUATE_DIPLOMA
  MASTERS
  DOCTORATE
  CERTIFICATE
  PROFESSIONAL
}

enum GradingSystem {
  PERCENTAGE
  GPA_4
  GPA_5
  CGPA_10
  LETTER
  WASSCE
  FIRST_CLASS
  OTHER
}

enum NotificationType {
  CHAT_MESSAGE
  NEW_BOOKING
  NEW_APPLICATION
  NEW_RESERVATION
  NEW_TESTIMONIAL
  BOOKING_STATUS_CHANGE
  APPLICATION_STATUS_CHANGE
  PAYMENT_RECEIVED
  SYSTEM_ALERT
}

enum TestType {
  TOEFL
  IELTS
  DUOLINGO
  PTE
  SAT
  ACT
  GRE
  GMAT
  MCAT
  LSAT
}

model FlightReservation {
  id                String            @id @default(uuid())
  userId            String            @map("user_id")
  
  // Flight Details
  origin            String            @db.VarChar(10)
  destination       String            @db.VarChar(10)
  departureDate     DateTime          @map("departure_date")
  returnDate        DateTime?         @map("return_date")
  adults            Int               @default(1)
  children          Int               @default(0)
  infants           Int               @default(0)
  cabin             String            @db.VarChar(20)
  
  // Selected Flight Info
  airline           String?           @db.VarChar(200)
  flightNumber      String?           @map("flight_number") @db.VarChar(50)
  departureTime     String?           @map("departure_time") @db.VarChar(20)
  arrivalTime       String?           @map("arrival_time") @db.VarChar(20)
  duration          String?           @db.VarChar(50)
  stops             Int?
  flightDetails     Json?             @map("flight_details")
  
  // Pricing
  basePriceUSD      Decimal?          @map("base_price_usd") @db.Decimal(10, 2)
  basePriceGHS      Decimal?          @map("base_price_ghs") @db.Decimal(10, 2)
  serviceFee        Decimal?          @map("service_fee") @db.Decimal(10, 2)
  totalAmount       Decimal?          @map("total_amount") @db.Decimal(10, 2)
  exchangeRate      Decimal?          @map("exchange_rate") @db.Decimal(10, 4)
  
  // Quote System
  status            ReservationStatus @default(PENDING_QUOTE)
  quoteNotes        String?           @map("quote_notes") @db.Text
  adminNotes        String?           @map("admin_notes") @db.Text
  approvedBy        String?           @map("approved_by")
  approvedAt        DateTime?         @map("approved_at")
  
  // Payment
  paymentStatus     PaymentStatus     @default(PENDING) @map("payment_status")
  paymentReference  String?           @map("payment_reference") @db.VarChar(200)
  paidAt            DateTime?         @map("paid_at")
  
  createdAt         DateTime          @default(now()) @map("created_at")
  updatedAt         DateTime          @updatedAt @map("updated_at")
  
  user              User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  packageReservations PackageReservation[] @relation("FlightInPackage")
  
  @@map("flight_reservations")
}

model HotelReservation {
  id                String            @id @default(uuid())
  userId            String            @map("user_id")
  
  // Hotel Search
  city              String            @db.VarChar(200)
  country           String?           @db.VarChar(100)
  checkInDate       DateTime          @map("check_in_date")
  checkOutDate      DateTime          @map("check_out_date")
  adults            Int               @default(1)
  children          Int               @default(0)
  rooms             Int               @default(1)
  
  // Selected Hotel Info
  hotelName         String?           @map("hotel_name") @db.VarChar(300)
  hotelAddress      String?           @map("hotel_address") @db.Text
  roomType          String?           @map("room_type") @db.VarChar(200)
  amenities         Json?
  starRating        Int?              @map("star_rating")
  hotelDetails      Json?             @map("hotel_details")
  
  // Pricing
  basePriceUSD      Decimal?          @map("base_price_usd") @db.Decimal(10, 2)
  basePriceGHS      Decimal?          @map("base_price_ghs") @db.Decimal(10, 2)
  serviceFee        Decimal?          @map("service_fee") @db.Decimal(10, 2)
  totalAmount       Decimal?          @map("total_amount") @db.Decimal(10, 2)
  exchangeRate      Decimal?          @map("exchange_rate") @db.Decimal(10, 4)
  nights            Int?
  
  // Quote System
  status            ReservationStatus @default(PENDING_QUOTE)
  quoteNotes        String?           @map("quote_notes") @db.Text
  adminNotes        String?           @map("admin_notes") @db.Text
  approvedBy        String?           @map("approved_by")
  approvedAt        DateTime?         @map("approved_at")
  
  // Payment
  paymentStatus     PaymentStatus     @default(PENDING) @map("payment_status")
  paymentReference  String?           @map("payment_reference") @db.VarChar(200)
  paidAt            DateTime?         @map("paid_at")
  
  createdAt         DateTime          @default(now()) @map("created_at")
  updatedAt         DateTime          @updatedAt @map("updated_at")
  
  user              User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  packageReservations PackageReservation[] @relation("HotelInPackage")
  
  @@map("hotel_reservations")
}

model PackageReservation {
  id                  String            @id @default(uuid())
  userId              String            @map("user_id")
  flightReservationId String            @map("flight_reservation_id")
  hotelReservationId  String            @map("hotel_reservation_id")
  
  // Package Discount
  packageDiscount     Decimal?          @map("package_discount") @db.Decimal(10, 2)
  discountPercent     Decimal?          @map("discount_percent") @db.Decimal(5, 2)
  
  // Pricing
  totalAmount         Decimal?          @map("total_amount") @db.Decimal(10, 2)
  
  // Quote System
  status              ReservationStatus @default(PENDING_QUOTE)
  adminNotes          String?           @map("admin_notes") @db.Text
  approvedBy          String?           @map("approved_by")
  approvedAt          DateTime?         @map("approved_at")
  
  // Payment
  paymentStatus       PaymentStatus     @default(PENDING) @map("payment_status")
  paymentReference    String?           @map("payment_reference") @db.VarChar(200)
  paidAt              DateTime?         @map("paid_at")
  
  createdAt           DateTime          @default(now()) @map("created_at")
  updatedAt           DateTime          @updatedAt @map("updated_at")
  
  user                User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  flightReservation   FlightReservation @relation("FlightInPackage", fields: [flightReservationId], references: [id], onDelete: Cascade)
  hotelReservation    HotelReservation  @relation("HotelInPackage", fields: [hotelReservationId], references: [id], onDelete: Cascade)
  
  @@map("package_reservations")
}

model VisaAssistanceBooking {
  id                    String        @id @default(uuid())
  userId                String        @map("user_id")
  serviceId             String        @map("service_id")
  
  // Contact Information
  contactFullName       String        @map("contact_full_name") @db.VarChar(200)
  contactEmail          String        @map("contact_email") @db.VarChar(200)
  contactPhone          String        @map("contact_phone") @db.VarChar(50)
  contactResidence      String        @map("contact_residence") @db.VarChar(300)
  
  // Visa Details
  destinationCountry    String        @map("destination_country") @db.VarChar(200)
  travelPurpose         String        @map("travel_purpose") @db.VarChar(100) // Tourism, Business, Study, Visit Family, Work, etc.
  plannedTravelDate     DateTime?     @map("planned_travel_date") @db.Date
  durationOfStay        String?       @map("duration_of_stay") @db.VarChar(50) // e.g., "2 weeks", "3 months"
  
  // Applicant Information
  applicants            Json          // Array of applicant objects with name, age, nationality, passportNumber, passportExpiry
  applicantCount        Int           @map("applicant_count")
  
  // Current Status
  hasValidPassport      Boolean       @map("has_valid_passport")
  passportExpiryDate    DateTime?     @map("passport_expiry_date") @db.Date
  previousVisaRefusal   Boolean       @map("previous_visa_refusal")
  refusalDetails        String?       @map("refusal_details") @db.Text
  
  // Additional Services
  needsDocumentation    Boolean       @default(false) @map("needs_documentation") // Document preparation
  needsAppointment      Boolean       @default(false) @map("needs_appointment") // Embassy appointment booking
  needsTranslation      Boolean       @default(false) @map("needs_translation") // Document translation
  rushProcessing        Boolean       @default(false) @map("rush_processing") // Expedited service
  
  // Additional Information
  additionalNotes       String?       @map("additional_notes") @db.Text
  referralSource        String        @map("referral_source") @db.VarChar(100)
  
  // Payment & Status
  feeEstimate           Decimal?      @map("fee_estimate") @db.Decimal(10, 2)
  finalFee              Decimal?      @map("final_fee") @db.Decimal(10, 2)
  status                BookingStatus @default(PENDING)
  paymentStatus         PaymentStatus @default(PENDING) @map("payment_status")
  paymentReference      String?       @map("payment_reference") @db.VarChar(100)
  
  // Admin Notes
  adminNotes            String?       @map("admin_notes") @db.Text
  
  // Metadata
  createdAt             DateTime      @default(now()) @map("created_at")
  updatedAt             DateTime      @updatedAt @map("updated_at")
  confirmedAt           DateTime?     @map("confirmed_at")
  completedAt           DateTime?     @map("completed_at")
  
  // Relations
  user                  User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  service               Service       @relation(fields: [serviceId], references: [id])
  
  @@map("visa_assistance_bookings")
}

model ItineraryBooking {
  id                    String        @id @default(uuid())
  userId                String        @map("user_id")
  serviceId             String        @map("service_id")
  
  // Contact Information
  contactFullName       String        @map("contact_full_name") @db.VarChar(200)
  contactEmail          String        @map("contact_email") @db.VarChar(200)
  contactPhone          String        @map("contact_phone") @db.VarChar(50)
  
  // Trip Details
  destination           String        @map("destination") @db.VarChar(300) // Can be multiple cities/countries
  travelStartDate       DateTime      @map("travel_start_date") @db.Date
  travelEndDate         DateTime      @map("travel_end_date") @db.Date
  tripDuration          String        @map("trip_duration") @db.VarChar(50)
  
  // Travelers
  travelers             Json          // Array of traveler objects with name, age, type
  travelerCount         Int           @map("traveler_count")
  
  // Trip Preferences
  tripType              Json          @map("trip_type") // Array: Adventure, Relaxation, Cultural, Business, etc.
  accommodationType     String        @map("accommodation_type") @db.VarChar(100) // Luxury, Mid-range, Budget, Airbnb, etc.
  transportPreference   Json          @map("transport_preference") // Array: Flights, Trains, Car rental, Private driver, etc.
  
  // Interests & Activities
  interests             Json          // Array of interests: Museums, Beaches, Nightlife, Food tours, etc.
  mustVisit             String?       @map("must_visit") @db.Text // Specific places they must see
  avoidPreferences      String?       @map("avoid_preferences") @db.Text // Things to avoid
  
  // Dining & Special Requirements
  dietaryRestrictions   Json?         @map("dietary_restrictions") // Array
  mobilityRequirements  String?       @map("mobility_requirements") @db.Text
  specialRequests       String?       @map("special_requests") @db.Text
  
  // Budget
  budgetRange           String        @map("budget_range") @db.VarChar(100)
  budgetIncludes        Json?         @map("budget_includes") // Array: Accommodation, Food, Activities, Transport, etc.
  
  // Itinerary Preferences
  pacingPreference      String        @map("pacing_preference") @db.VarChar(50) // Relaxed, Moderate, Packed
  planningLevel         String        @map("planning_level") @db.VarChar(50) // Detailed hour-by-hour, Daily overview, Flexible suggestions
  needsReservations     Boolean       @default(false) @map("needs_reservations") // Need us to make restaurant/activity bookings
  
  // Additional Information
  previousExperience    String?       @map("previous_experience") @db.Text // Have they visited the destination before
  additionalNotes       String?       @map("additional_notes") @db.Text
  referralSource        String        @map("referral_source") @db.VarChar(100)
  
  // Payment & Status
  feeEstimate           Decimal?      @map("fee_estimate") @db.Decimal(10, 2)
  finalFee              Decimal?      @map("final_fee") @db.Decimal(10, 2)
  status                BookingStatus @default(PENDING)
  paymentStatus         PaymentStatus @default(PENDING) @map("payment_status")
  paymentReference      String?       @map("payment_reference") @db.VarChar(100)
  
  // Deliverables
  itineraryDelivered    Boolean       @default(false) @map("itinerary_delivered")
  itineraryUrl          String?       @map("itinerary_url") @db.VarChar(500) // Link to delivered itinerary document
  
  // Admin Notes
  adminNotes            String?       @map("admin_notes") @db.Text
  
  // Metadata
  createdAt             DateTime      @default(now()) @map("created_at")
  updatedAt             DateTime      @updatedAt @map("updated_at")
  confirmedAt           DateTime?     @map("confirmed_at")
  completedAt           DateTime?     @map("completed_at")
  
  // Relations
  user                  User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  service               Service       @relation(fields: [serviceId], references: [id])
  
  @@map("itinerary_bookings")
}
