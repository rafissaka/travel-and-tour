// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-3.0.x", "windows"]
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

// Enums
enum UserRole {
  USER
  ADMIN
  SUPER_ADMIN
}

enum BookingStatus {
  PENDING
  CONFIRMED
  CANCELLED
  COMPLETED
}

enum PaymentStatus {
  PENDING
  PAID
  REFUNDED
}

enum Sex {
  MALE
  FEMALE
  OTHER
}

enum ProcessStatus {
  INQUIRY
  DOCUMENTS_PENDING
  DOCUMENTS_RECEIVED
  DOCUMENTS_VERIFIED
  PAYMENT_PENDING
  PAYMENT_PARTIAL
  PAYMENT_COMPLETE
  VISA_PROCESSING
  VISA_APPROVED
  VISA_REJECTED
  TRAVEL_ARRANGED
  COMPLETED
  CANCELLED
}

enum EventStatus {
  UPCOMING
  ONGOING
  ENDED
  CANCELLED
}

// User Authentication & Profile
model User {
  id                String    @id @default(uuid())
  email             String    @unique
  passwordHash      String    @map("password_hash")
  firstName         String?   @map("first_name") @db.VarChar(100)
  lastName          String?   @map("last_name") @db.VarChar(100)
  phone             String?   @db.VarChar(20)
  role              UserRole  @default(USER)
  avatarUrl         String?   @map("avatar_url")
  emailVerified     Boolean   @default(false) @map("email_verified")
  verificationToken String?   @unique @map("verification_token")
  resetToken        String?   @unique @map("reset_token")
  resetTokenExpiry  DateTime? @map("reset_token_expiry")
  isActive          Boolean   @default(true) @map("is_active")
  lastLoginAt       DateTime? @map("last_login_at")
  loginCount        Int       @default(0) @map("login_count")
  createdAt         DateTime  @default(now()) @map("created_at")
  updatedAt         DateTime  @updatedAt @map("updated_at")

  // Relations
  profile       UserProfile?
  bookings      Booking[]
  activities    UserActivity[]
  wishlists     UserWishlist[]
  createdEvents Event[]
  createdServices Service[]
  testimonials  Testimonial[]
  uploadedGalleryImages GalleryImage[]
  createdTravelers Traveler[]

  @@map("users")
}

model UserProfile {
  id               String   @id @default(uuid())
  userId           String   @unique @map("user_id")
  dateOfBirth      DateTime? @map("date_of_birth") @db.Date
  nationality      String?  @db.VarChar(100)
  passportNumber   String?  @map("passport_number") @db.VarChar(50)
  emergencyContact String?  @map("emergency_contact") @db.VarChar(100)
  emergencyPhone   String?  @map("emergency_phone") @db.VarChar(20)
  preferences      Json?    // Travel preferences, interests, etc.
  createdAt        DateTime @default(now()) @map("created_at")
  updatedAt        DateTime @updatedAt @map("updated_at")

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("user_profiles")
}

// Services Management
model Service {
  id              String    @id @default(uuid())
  title           String    @db.VarChar(200)
  slug            String    @unique @db.VarChar(200)
  tagline         String?   @db.VarChar(100)
  description     String?   @db.Text
  fullDescription String?   @map("full_description") @db.Text
  iconName        String?   @map("icon_name") @db.VarChar(50)
  category        String?   @db.VarChar(50)
  color           String?   @db.VarChar(20)
  imageUrl        String?   @map("image_url")
  features        Json?     // Array of features
  priceRange      String?   @map("price_range") @db.VarChar(50)
  isActive        Boolean   @default(true) @map("is_active")
  displayOrder    Int       @default(0) @map("display_order")
  createdById     String?   @map("created_by")
  createdAt       DateTime  @default(now()) @map("created_at")
  updatedAt       DateTime  @updatedAt @map("updated_at")

  createdBy User?     @relation(fields: [createdById], references: [id])
  bookings  Booking[]
  wishlists UserWishlist[]

  @@map("services")
}

// Events/Tours Management
model Event {
  id                  String       @id @default(uuid())
  title               String       @db.VarChar(200)
  slug                String       @unique @db.VarChar(200)
  description         String?      @db.Text
  imageUrl            String?      @map("image_url")
  location            String?      @db.VarChar(200)
  startDate           DateTime?    @map("start_date") @db.Date
  endDate             DateTime?    @map("end_date") @db.Date
  duration            String?      @db.VarChar(50)
  status              EventStatus  @default(UPCOMING)
  category            String?      @db.VarChar(50)
  price               Decimal?     @db.Decimal(10, 2)
  maxParticipants     Int?         @map("max_participants")
  currentParticipants Int          @default(0) @map("current_participants")
  includes            Json?        // What's included in the tour
  requirements        Json?        // Requirements for participants
  itinerary           Json?        // Day-by-day itinerary
  isFeatured          Boolean      @default(false) @map("is_featured")
  isActive            Boolean      @default(true) @map("is_active")
  createdById         String?      @map("created_by")
  createdAt           DateTime     @default(now()) @map("created_at")
  updatedAt           DateTime     @updatedAt @map("updated_at")

  createdBy User?     @relation(fields: [createdById], references: [id])
  images    EventImage[]
  bookings  Booking[]
  wishlists UserWishlist[]

  @@map("events")
}

model EventImage {
  id           String   @id @default(uuid())
  eventId      String   @map("event_id")
  imageUrl     String   @map("image_url")
  caption      String?  @db.Text
  displayOrder Int      @default(0) @map("display_order")
  createdAt    DateTime @default(now()) @map("created_at")

  event Event @relation(fields: [eventId], references: [id], onDelete: Cascade)

  @@map("event_images")
}

// Bookings Management
model Booking {
  id              String        @id @default(uuid())
  userId          String        @map("user_id")
  eventId         String?       @map("event_id")
  serviceId       String?       @map("service_id")
  bookingType     String        @map("booking_type") @db.VarChar(20)
  status          BookingStatus @default(PENDING)
  participants    Int           @default(1)
  totalAmount     Decimal?      @map("total_amount") @db.Decimal(10, 2)
  paymentStatus   PaymentStatus @default(PENDING) @map("payment_status")
  specialRequests String?       @map("special_requests") @db.Text
  bookingDate     DateTime      @default(now()) @map("booking_date")
  confirmedAt     DateTime?     @map("confirmed_at")
  cancelledAt     DateTime?     @map("cancelled_at")
  createdAt       DateTime      @default(now()) @map("created_at")
  updatedAt       DateTime      @updatedAt @map("updated_at")

  user    User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  event   Event?   @relation(fields: [eventId], references: [id])
  service Service? @relation(fields: [serviceId], references: [id])

  @@map("bookings")
}

// User Activity Tracking
model UserActivity {
  id           String   @id @default(uuid())
  userId       String   @map("user_id")
  activityType String   @map("activity_type") @db.VarChar(50)
  activityData Json?    @map("activity_data")
  ipAddress    String?  @map("ip_address") @db.VarChar(50)
  userAgent    String?  @map("user_agent") @db.Text
  createdAt    DateTime @default(now()) @map("created_at")

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("user_activities")
}

// Wishlist/Saved Items
model UserWishlist {
  id        String   @id @default(uuid())
  userId    String   @map("user_id")
  eventId   String?  @map("event_id")
  serviceId String?  @map("service_id")
  itemType  String   @map("item_type") @db.VarChar(20)
  createdAt DateTime @default(now()) @map("created_at")

  user    User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  event   Event?   @relation(fields: [eventId], references: [id])
  service Service? @relation(fields: [serviceId], references: [id])

  @@map("user_wishlists")
}

// Testimonials
model Testimonial {
  id         String   @id @default(uuid())
  userId     String?  @map("user_id")
  name       String   @db.VarChar(100)
  title      String?  @db.VarChar(100)
  content    String   @db.Text
  avatarUrl  String?  @map("avatar_url")
  rating     Int?     @db.SmallInt
  isFeatured Boolean  @default(false) @map("is_featured")
  isApproved Boolean  @default(false) @map("is_approved")
  createdAt  DateTime @default(now()) @map("created_at")
  updatedAt  DateTime @updatedAt @map("updated_at")

  user User? @relation(fields: [userId], references: [id])

  @@map("testimonials")
}

// Gallery Management
model GalleryImage {
  id           String   @id @default(uuid())
  title        String?  @db.VarChar(200)
  description  String?  @db.Text
  imageUrl     String   @map("image_url")
  category     String?  @db.VarChar(50)
  tags         Json?
  isFeatured   Boolean  @default(false) @map("is_featured")
  displayOrder Int      @default(0) @map("display_order")
  uploadedById String?  @map("uploaded_by")
  createdAt    DateTime @default(now()) @map("created_at")

  uploadedBy User? @relation(fields: [uploadedById], references: [id])

  @@map("gallery_images")
}

// Traveler/Client Management
model Traveler {
  id              String        @id @default(uuid())
  firstName       String        @map("first_name") @db.VarChar(100)
  middleName      String?       @map("middle_name") @db.VarChar(100)
  surname         String        @db.VarChar(100)
  sex             Sex
  nationality     String        @db.VarChar(100)
  dateOfBirth     DateTime      @map("date_of_birth") @db.Date
  placeOfBirth    String        @map("place_of_birth") @db.VarChar(200)
  passportNumber  String        @map("passport_number") @db.VarChar(50)
  workTitle       String?       @map("work_title") @db.VarChar(200)
  email           String?       @db.VarChar(255)
  phone           String?       @db.VarChar(20)
  address         String?       @db.Text

  // Payment tracking
  paymentAmount   Decimal?      @map("payment_amount") @db.Decimal(10, 2)
  paymentDate     DateTime?     @map("payment_date")
  paymentStatus   PaymentStatus @default(PENDING) @map("payment_status")

  // Process tracking
  processStatus   ProcessStatus @default(INQUIRY) @map("process_status")
  notes           String?       @db.Text

  // Metadata
  createdById     String        @map("created_by")
  createdAt       DateTime      @default(now()) @map("created_at")
  updatedAt       DateTime      @updatedAt @map("updated_at")
  deletedAt       DateTime?     @map("deleted_at")

  createdBy User @relation(fields: [createdById], references: [id])

  @@map("travelers")
}
